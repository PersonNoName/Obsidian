# 配置类

## 概述

项目使用多个配置类来管理框架组件和应用程序行为。

## FreeTraderApplication - 启动类

**文件位置**: `FreeTraderApplication.java`

```java
@SpringBootApplication
public class FreeTraderApplication {
    public static void main(String[] args) {
        SpringApplication.run(FreeTraderApplication.class, args);
    }
}
```

## MyBatisPlusConfig - MyBatis-Plus 配置

**文件位置**: `config/MyBatisPlusConfig.java`

```java
@Configuration
public class MyBatisPlusConfig {

    // 注入分页插件
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```

### 配置说明

- 添加分页插件，支持 `Page` 对象进行分页查询

## CorsConfig - 跨域配置

**文件位置**: `config/CorsConfig.java`

```java
@Configuration
public class CorsConfig {

    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration config = new CorsConfiguration();
        // 允许的来源
        config.addAllowedOrigin("http://localhost:3000");
        // 允许携带认证信息
        config.setAllowCredentials(true);
        // 允许的 HTTP 方法
        config.addAllowedMethod("*");
        // 允许的请求头
        config.addAllowedHeader("*");
        // 暴露的响应头
        config.addExposedHeader("Authorization");

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", config);

        return new CorsFilter(source);
    }
}
```

### 配置说明

| 配置项 | 值 | 说明 |
|--------|-----|------|
| `addAllowedOrigin` | `http://localhost:3000` | 允许的前端来源 |
| `setAllowCredentials` | `true` | 允许携带 Cookie |
| `addAllowedMethod` | `*` | 允许所有 HTTP 方法 |
| `addAllowedHeader` | `*` | 允许所有请求头 |
| `addExposedHeader` | `Authorization` | 暴露 Token 响应头 |

## PasswordEncoderConfig - 密码加密配置

**文件位置**: `config/PasswordEncoderConfig.java`

```java
@Configuration
public class PasswordEncoderConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

### 说明

使用 BCrypt 算法进行密码加密，具有以下特点：
- 自动加盐
- 慢哈希算法，防暴力破解
- 每次生成的哈希值不同，但验证时一致

## SecurityConfig - Spring Security 配置

详见 [[08-安全认证]]

## application.yml - 配置文件

**文件位置**: `resources/application.yml`

### 完整配置

```yaml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:mysql://106.12.52.116:1999/freetrader?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: free
    password: free123
    driver-class-name: com.mysql.cj.jdbc.Driver

  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: Asia/Shanghai

mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  type-aliases-package: com.freetrader.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deletedAt
      logic-delete-value: NOW()
      logic-not-delete-value: "null"

jwt:
  secret: freetrader-secret-key-for-jwt-token-generation-must-be-at-least-256-bits-long
  expiration: 86400000

app:
  trading-days: 7
  top-funds: 10
```

### MyBatis-Plus 配置说明

| 配置项 | 说明 |
|--------|------|
| `mapper-locations` | Mapper XML 文件位置 |
| `type-aliases-package` | 实体类包路径 |
| `map-underscore-to-camel-case` | 开启下划线转驼峰 |
| `logic-delete-field` | 逻辑删除字段 |
| `logic-delete-value` | 删除值 |
| `logic-not-delete-value` | 未删除值 |

### 应用配置说明

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `app.trading-days` | 7 | 计算收益率的交易日数 |
| `app.top-funds` | 10 | 板块详情显示的 ETF 数量 |

## 相关笔记

- [[08-安全认证]]
- [[09-JWT实现]]
